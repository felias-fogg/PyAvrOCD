<!DOCTYPE html>

<html class="writer-html5" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="../img/favicon.ico" rel="shortcut icon"/>
<title>Flash wear - pyavrocd</title>
<link href="../css/theme.css" rel="stylesheet"/>
<link href="../css/theme_extra.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" rel="stylesheet"/>
<link href="../style.css" rel="stylesheet"/>
<script>
        // Current page data
        var mkdocs_page_name = "Flash wear";
        var mkdocs_page_input_path = "flash-wear.md";
        var mkdocs_page_url = null;
      </script>
<!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
<link href="../../docs/pyavrocd.pdf" rel="alternate" title="PDF" type="application/pdf"/></head>
<body class="wy-body-for-nav" role="document">
<div class="wy-grid-for-nav">
<nav class="wy-nav-side stickynav" data-toggle="wy-nav-shift">
<div class="wy-side-scroll">
<div class="wy-side-nav-search">
<a class="icon icon-home" href=".."> pyavrocd
        </a><div role="search">
<form action="../search.html" class="wy-form" id="rtd-search-form" method="get">
<input aria-label="Search docs" name="q" placeholder="Search docs" title="Type search term here" type="text"/>
</form>
</div>
</div>
<div aria-label="Navigation menu" class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation">
<p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../INSTALL/">GDB server</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../debugging-software/">Debugging software</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../board-preparation/">Preparing the target</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../connect-to-target/">Connecting to target</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../command-line-options/">Invoking the server</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../usage/">Debugging the target</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../monitor-commands/">Monitor commands</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../restore-original-state/">Restoring the target</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../configuration/">Configuration</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Supported devices</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../supported-mcus-and-boards/">MCUs</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../supported-debuggers/">Hardware debuggers</a>
</li>
</ul>
<p class="caption"><span class="caption-text">Caveats</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../disclaimer/">Disclaimer</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../debugwire-risks/">debugWIRE</a>
</li>
<li class="toctree-l1 current"><a class="reference internal current" href="#">Flash wear</a>
<ul class="current">
<li class="toctree-l2"><a class="reference internal" href="#the-flash-wear-problem">The flash wear problem</a>
</li>
<li class="toctree-l2"><a class="reference internal" href="#using-only-hardware-breakpoints">Using only hardware breakpoints</a>
</li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../release-notes/">Release notes</a>
</li>
<li class="toctree-l1"><a class="reference internal" href="../LICENSE.txt">License</a>
</li>
</ul>
</div>
</div>
</nav>
<section class="wy-nav-content-wrap" data-toggle="wy-nav-shift">
<nav aria-label="Mobile navigation menu" class="wy-nav-top" role="navigation">
<i class="fa fa-bars" data-toggle="wy-nav-top"></i>
<a href="..">pyavrocd</a>
</nav>
<div class="wy-nav-content">
<div class="rst-content"><div aria-label="breadcrumbs navigation" role="navigation">
<ul class="wy-breadcrumbs">
<li><a aria-label="Docs" class="icon icon-home" href=".."></a></li>
<li class="breadcrumb-item">Caveats</li>
<li class="breadcrumb-item active">Flash wear</li>
<li class="wy-breadcrumbs-aside">
<a class="icon icon-github" href="https://github.com/felias-fogg/pyavrocd/edit/master/docs/flash-wear.md"> Edit on GitHub</a>
</li>
</ul>
<hr/>
</div>
<div class="document" itemscope="itemscope" itemtype="http://schema.org/Article" role="main">
<div class="section" itemprop="articleBody">
<h1 id="flash-wear">Flash Wear</h1>
<p>When setting a breakpoint in a program, one usually does not think about the underlying mechanism that stops the program at the particular point where the breakpoint has been set. Technically, this can be done by <em>hardware breakpoints</em> or <em>software breakpoints</em>. A hardware breakpoint is implemented as a register that is compared to the actual program counter. If the PC is equal to the register value, execution is stopped. Usually, only a few such hardware breakpoints are available. On a debugWIRE device, there is just one. On AVR JTAG ATmegas, we have four; on UPDI MCUs, there are two. Software breakpoints are implemented by placing a particular trap instruction into the machine code. On AVRs, this is the <code>BREAK</code> instruction.</p>
<p>There are pros and cons to each type of breakpoint. Hardware breakpoints are faster to set and to clear because they do not involve reprogramming flash memory. Further, they do not lead to <em><a href="https://en.wikipedia.org/wiki/Flash_memory#Memory_wear">flash wear</a></em> as software breakpoints do. However, as mentioned, there are usually only very few hardware breakpoints.</p>
<h2 id="the-flash-wear-problem">The flash wear problem</h2>
<p>So, how severe is the flash wear problem? The data sheets state that for classic AVR MCUs, the guaranteed flash endurance is 10,000 write/erase cycles. For the more recent MCU with UPDI interface, it is only 1000 cycles! These are probably quite conservative numbers guaranteeing endurance even when the chips are operated close to the limits of their specification (e.g., at 50° C).</p>
<p>Let’s assume an eager developer who reprograms the MCU every 10 minutes with an updated version of the program and debugs using five software breakpoints that she sets and clears during each episode. That will probably result on average in 3 additional reprogramming operations on an individual page, leading to 4 such operations in 10 minutes or 192 such operations on one workday. So, she could hit the limit for the modern AVR MCUs after one working week already. The classic AVRs can be used for 10 weeks. This holds only if she does not set and clear breakpoints all the time, but is instead rather careful about doing so. Further, the software debugger needs to make sure not to require superfluous breakpoint set/clear operations.</p>
<p>Different <a href="https://arduino-craft-corner.de/index.php/2025/05/05/stop-and-go/">GDB servers vary in their ability to minimize flash wear</a>, with pyavrocd being very competitive. However, all in all, as Microchip states, you should not ship MCUs to customers that have been used heavily in testing.</p>
<h2 id="using-only-hardware-breakpoints">Using only hardware breakpoints</h2>
<p>Can it be a solution to use only hardware breakpoints? It will definitely reduce flash wear to zero (well, except for reprogramming the target). However, it can also be very inconvenient because there are only a few of them. You can force the use of only hardware breakpoints by the <code>monitor</code> command:</p>
<pre><code>monitor breakpoint hardware
</code></pre>
<p>One must be aware, though, that there is a slight problem here when single-stepping. If GDB continues from a location at which a breakpoint is set, it will assert all user-requested breakpoints except the one at this particular location. Then GDB requests a single step, and afterwards asserts the breakpoint at the original location. Since a stepping-over operation uses a temporary breakpoint, this can lead to the situation where, after starting the stepping-over operation with a single step, it is discovered that too many breakpoints are necessary to complete the step-over operation. This is not a disaster, but it is very confusing. Unfortunately, there is no way to detect this problem early enough at the level of the GDB server. And there does not seem to be an easy way to solve the issue on the GDB level.</p>
<p>So, when using only hardware breakpoints, do not use the maximum number of breakpoints or refrain from the stepping-over operation (called <code>next</code> in GDB).</p>
</div>
</div><footer>
<div aria-label="Footer Navigation" class="rst-footer-buttons" role="navigation">
<a class="btn btn-neutral float-left" href="../debugwire-risks/" title="debugWIRE"><span class="icon icon-circle-arrow-left"></span> Previous</a>
<a class="btn btn-neutral float-right" href="../release-notes/" title="Release notes">Next <span class="icon icon-circle-arrow-right"></span></a>
</div>
<hr/>
<div role="contentinfo">
<!-- Copyright etc -->
</div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
</div>
</div>
</section>
</div>
<div aria-label="Versions" class="rst-versions" role="note">
<span class="rst-current-version" data-toggle="rst-current-version">
<span>
<a class="fa fa-github" href="https://github.com/felias-fogg/pyavrocd" style="color: #fcfcfc"> GitHub</a>
</span>
<span><a href="../debugwire-risks/" style="color: #fcfcfc">« Previous</a></span>
<span><a href="../release-notes/" style="color: #fcfcfc">Next »</a></span>
</span>
</div>
<script src="../js/jquery-3.6.0.min.js"></script>
<script>var base_url = "..";</script>
<script src="../js/theme_extra.js"></script>
<script src="../js/theme.js"></script>
<script src="../search/main.js"></script>
<script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>
</body>
</html>
