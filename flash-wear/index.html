<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Flash wear - PyAvrOCD</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../style.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Flash wear";
        var mkdocs_page_input_path = "flash-wear.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="..">
          <img src="../pics/logo-tiny.png" class="logo" alt="Logo"/>
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Installation</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../install-link/">PyAvrOCD</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../debugging-software/">Debugging software</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Usage</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../configuration/">Configuration</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../board-preparation/">Preparing the target</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../connect-to-target/">Connecting to the target</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../command-line-options/">Invoking the server</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../debugging/">Debugging on the target</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../monitor-commands/">Monitor commands</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../restore-original-state/">Restoring the target</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Supported devices</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../supported-mcus/">MCUs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../supported-boards/">Boards</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../supported-debuggers/">Hardware debuggers</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Caveats</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../disclaimer/">Disclaimer</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../debugwire-risks/">debugWIRE</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Flash wear</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#the-flash-wear-problem">The flash wear problem</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#using-only-hardware-breakpoints">Using only hardware breakpoints</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../limitations/">Limitations</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">About</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../license-link/">License</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../release-notes/">Release notes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../contributing/">Contributing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../credits-link/">Credits</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../code_of_conduct-link/">Code of conduct</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">PyAvrOCD</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Caveats</li>
      <li class="breadcrumb-item active">Flash wear</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/felias-fogg/PyAvrOCD/edit/master/docs/flash-wear.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="flash-wear">Flash Wear</h1>
<p>When setting a breakpoint in a program, one usually does not think about the underlying mechanism that stops the program at the particular point where the breakpoint has been set. Technically, this can be done by <em>hardware breakpoints</em> or <em>software breakpoints</em>. A hardware breakpoint is implemented as a register that is compared to the actual program counter. If the PC is equal to the register value, execution is stopped. Usually, only a few such hardware breakpoints are available. On a debugWIRE device, there is just one. On AVR JTAG ATmegas, we have four; on UPDI MCUs, there are two. Software breakpoints are implemented by placing a particular trap instruction into the machine code. On AVRs, this is the <code>BREAK</code> instruction.</p>
<p>There are pros and cons to each type of breakpoint. Hardware breakpoints are faster to set and to clear because they do not involve reprogramming flash memory. Further, they do not lead to <em><a href="https://en.wikipedia.org/wiki/Flash_memory#Memory_wear">flash wear</a></em> as software breakpoints do. However, as mentioned, there are only very few hardware breakpoints.</p>
<p>PyAvrOCD will make use of hardware breakpoints whenever possible and use software breakpoints only as a fallback. Further, the most recent breakpoint asserted by GDB will always be implemented as a hardware breakpoint because it is very likely that it is a temporary breakpoint. </p>
<h2 id="the-flash-wear-problem">The flash wear problem</h2>
<p>So, how severe is the flash wear problem? The data sheets state that for classic AVR MCUs, the guaranteed flash endurance is 10,000 write/erase cycles. For the more recent MCUs with the UPDI interface, it is only 1000 cycles! These are probably quite conservative numbers guaranteeing endurance even when the chips are operated close to the limits of their specification (e.g., at 50° C). So, one hopes that the endurance in practice is much higher.</p>
<p>Let’s assume an eager developer who reprograms the MCU every 10 minutes with an updated version of the program and debugs using five software breakpoints that she sets and clears during each episode. This means ten flash-page-reprogramming operations. That will probably result on average in 3 additional reprogramming operations on an individual page, leading together with reprogramming flash memory to 4 such operations in 10 minutes or 192 such operations on one workday. So, she could hit the limit for the modern AVR MCUs after one working week already. The classic AVRs can be used for 10 weeks. This, however, holds only if she does not set and clear breakpoints all the time, but is instead rather careful about doing so. </p>
<p>A further prerequisite for not wearing out flash memory too fast is that the GDB server minimizes flash wear. For instance, it should not remove and reinsert a software breakpoint every time a breakpoint is hit. However, <a href="https://arduino-craft-corner.de/index.php/2025/05/05/stop-and-go/">all AVR debugging solutions except for PyAvrOCD do that at software breakpoints with two-word instructions</a> (because the hardware debuggers implement it that way). Worse, the Bloom GDB server does that for every software breakpoint. If our eager developer uses a conditional breakpoint, and the program stops only after 100 iterations, then 200 reprogramming operations for one flash page are necessary. And this is already 1/5 of the flash endurance of a modern AVR MCU.</p>
<p>All in all, as Microchip states, you should not ship MCUs that have been used heavily in debugging to customers.</p>
<h2 id="using-only-hardware-breakpoints">Using only hardware breakpoints</h2>
<p>Can it be a solution to use only hardware breakpoints? It will definitely reduce flash wear to zero (well, except for reprogramming the target). And all GDB servers support that by trying to use hardware breakpoints as much as possible. Only when too many breakpoints are requested, software breakpoints are utilized. </p>
<p>You can enforce the use of <em>only</em> hardware breakpoints by employing the following <code>monitor</code> command.</p>
<pre><code class="language-text">monitor breakpoint hardware
</code></pre>
<p>After this command, you always get an error when more than the number of available hardware breakpoints is requested. One must be aware, though, that there might be slight problems when single-stepping and when continuing from a breakpoint.</p>
<p>A GDB step-over operation uses a temporary breakpoint, which can lead to the situation where, after starting a step-over operation with a single step on the GDB server level, it is discovered that too many breakpoints are necessary to complete the step-over operation. In this case, the initial single step is done, but then execution is stopped (in the middle of the step-over operation). </p>
<p>A similar situation can happen when you continue from a breakpoint. In this case, GDB initially does not assert the breakpoint it starts from, then it executes a single step, and, after that, asserts the original breakpoint. If one has requested just one breakpoint more than the maximum number, this will only be recognized after the initial single step, where the continue operation is stopped in this case.</p>
<p>Unfortunately, there is no way to detect these problems early enough at the level of the GDB server. And there does not seem to be an easy way to solve the issue on the GDB level. So, when using only hardware breakpoints, you should take care not to set too many breakpoints. Do never assign more than the maximum number, and do not use the maximum number of breakpoints, or refrain from the stepping-over operation (called <code>next</code> in GDB). Otherwise, the execution of the program might be stopped at places you have not expected.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../debugwire-risks/" class="btn btn-neutral float-left" title="debugWIRE"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../limitations/" class="btn btn-neutral float-right" title="Limitations">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/felias-fogg/PyAvrOCD" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../debugwire-risks/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../limitations/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
